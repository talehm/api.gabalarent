"use strict";(self.webpackChunkstrapi=self.webpackChunkstrapi||[]).push([[6025],{76368:(h,f,t)=>{t.d(f,{D:()=>M});var s=t(74081),e=t(93415),D=t(67621);function P(c,_,d){if(!c||!_||!d)return{display:"none"};const{x:O,y:o}=d;return{transform:`translate(${O}px, ${o}px)`}}const M=({renderItem:c})=>{const{itemType:_,isDragging:d,item:O,initialOffset:o,currentOffset:E,mouseOffset:l}=(0,D.useDragLayer)(i=>({item:i.getItem(),itemType:i.getItemType(),initialOffset:i.getInitialSourceClientOffset(),currentOffset:i.getSourceClientOffset(),isDragging:i.isDragging(),mouseOffset:i.getClientOffset()}));return d?(0,s.jsx)(e.x,{height:"100%",left:0,position:"fixed",pointerEvents:"none",top:0,zIndex:100,width:"100%",children:(0,s.jsx)(e.x,{style:P(o,E,l),children:c({type:_,item:O})})}):null}},55535:(h,f,t)=>{t.d(f,{B:()=>B,D:()=>x,H:()=>p,R:()=>W});var s=t(74081),e=t(10701),D=t(21395),P=t(27997),M=t(73354),c=t(74758),_=t(27875),d=t(1180),O=t(10411),o=t(76827),E=t(61020),l=t(76368),i=t(47706),m=t(70627),n=t(72450);const y=(0,n.default)(e.k)`
  svg path {
    fill: ${({theme:g})=>g.colors.neutral600};
  }
`;function T({name:g}){return(0,s.jsxs)(e.k,{background:"primary100",borderStyle:"dashed",borderColor:"primary600",borderWidth:"1px",gap:3,hasRadius:!0,padding:3,shadow:"tableShadow",width:(0,d.pxToRem)(300),children:[(0,s.jsx)(y,{alignItems:"center",background:"neutral200",borderRadius:"50%",height:6,justifyContent:"center",width:6,children:(0,s.jsx)(O.Z,{width:`${8/16}rem`})}),(0,s.jsx)(D.Z,{fontWeight:"bold",children:g})]})}T.propTypes={name:m.string.isRequired};function w({type:g,item:u}){switch(g){case i.D.STAGE:return(0,s.jsx)(T,{...u});default:return null}}function x(){return(0,s.jsx)(l.D,{renderItem:w})}function W({children:g}){return(0,s.jsx)(P.A,{children:(0,s.jsx)(M.o,{tabIndex:-1,children:(0,s.jsx)(c.D,{children:g})})})}function B({href:g}){const{formatMessage:u}=(0,E.Z)();return(0,s.jsx)(d.Link,{startIcon:(0,s.jsx)(o.Z,{}),to:g,children:u({id:"global.back",defaultMessage:"Back"})})}function p({title:g,subtitle:u,navigationAction:K,primaryAction:A}){return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.SettingsPageTitle,{name:g}),(0,s.jsx)(_.T,{navigationAction:K,primaryAction:A,title:g,subtitle:u})]})}},86025:(h,f,t)=>{t.r(f),t.d(f,{default:()=>Y});var s=t(74081),e=t(1180),D=t(49402),P=t(44328),M=t(27279),c=t(10701),_=t(77970),d=t(70774),O=t(38566),o=t(38101),E=t(93153),l=t(50086),i=t(21395),m=t(10989),n=t(86967),y=t(4987),T=t(36938),w=t(26784),x=t(78665),W=t(61020),B=t(40464),p=t(51447),g=t(72450),u=t(59491),K=t(66360),A=t(55535),U=t(78099),v=t(47706),V=t(88181),gt=t(64797),Dt=t(85811),Mt=t(92401),ft=t(15816),Ot=t(97442),Pt=t(13576),mt=t(87830),ut=t(47184),Ct=t(364),Tt=t(71563),vt=t(49204),ht=t(47853),Lt=t(75719),yt=t(74919),At=t(29206),It=t(98934),Rt=t(43433),wt=t(8175),xt=t(76368);const G=(0,g.default)(e.Link)`
  align-items: center;
  height: ${(0,e.pxToRem)(32)};
  display: flex;
  justify-content: center;
  padding: ${({theme:a})=>`${a.spaces[2]}}`};
  width: ${(0,e.pxToRem)(32)};

  svg {
    height: ${(0,e.pxToRem)(12)};
    width: ${(0,e.pxToRem)(12)};

    path {
      fill: ${({theme:a})=>a.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:a})=>a.colors.neutral800};
      }
    }
  }
`;function J(){const{formatMessage:a}=(0,W.Z)(),{push:k}=(0,p.k6)(),{collectionTypes:X,singleTypes:b,isLoading:q}=(0,u.u)(),{meta:L,workflows:Z,isLoading:j,refetch:tt}=(0,V.u)(),[N,S]=M.useState(null),[st,I]=M.useState(!1),{del:et}=(0,e.useFetchClient)(),{formatAPIError:nt}=(0,e.useAPIErrorHandler)(),F=(0,e.useNotification)(),{getFeature:at,isLoading:H}=(0,K.u)(),{trackUsage:Q}=(0,e.useTracking)(),ot=(0,D.useSelector)(P.s),{allowedActions:{canCreate:z,canDelete:it}}=(0,e.useRBAC)(ot.settings["review-workflows"]),C=at("review-workflows"),{mutateAsync:rt,isLoading:lt}=(0,B.useMutation)(async({workflowId:r,stages:R})=>{const{data:{data:$}}=await et(`/admin/review-workflows/workflows/${r}`,{data:R});return $},{onSuccess(){F({type:"success",message:{id:"notification.success.deleted",defaultMessage:"Deleted"}})}}),_t=r=>[...X,...b].find($=>$.uid===r).info.displayName,dt=r=>{S(r)},Et=()=>{S(null)},ct=async()=>{try{const r=await rt({workflowId:N});return await tt(),S(null),r}catch(r){return F({type:"warning",message:nt(r)}),null}};return M.useEffect(()=>{!j&&!H&&C?.[v.C]&&L?.workflowCount>parseInt(C[v.C],10)&&I(!0)},[H,j,C,L?.workflowCount,L.workflowsTotal]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(A.H,{primaryAction:z&&(0,s.jsx)(e.LinkButton,{startIcon:(0,s.jsx)(T.Z,{}),size:"S",to:"/settings/review-workflows/create",onClick:r=>{C?.[v.C]&&L?.workflowCount>=parseInt(C[v.C],10)?(r.preventDefault(),I(!0)):Q("willCreateWorkflow")},children:a({id:"Settings.review-workflows.list.page.create",defaultMessage:"Create new workflow"})}),subtitle:a({id:"Settings.review-workflows.list.page.subtitle",defaultMessage:"Manage your content review process"}),title:a({id:"Settings.review-workflows.list.page.title",defaultMessage:"Review Workflows"})}),(0,s.jsxs)(A.R,{children:[j||q?(0,s.jsx)(c.k,{justifyContent:"center",children:(0,s.jsx)(_.a,{children:a({id:"Settings.review-workflows.page.list.isLoading",defaultMessage:"Workflows are loading"})})}):(0,s.jsxs)(d.i,{colCount:3,footer:z&&(0,s.jsx)(O.c,{icon:(0,s.jsx)(T.Z,{}),onClick:()=>{C?.[v.C]&&L?.workflowCount>=parseInt(C[v.C],10)?I(!0):(k("/settings/review-workflows/create"),Q("willCreateWorkflow"))},children:a({id:"Settings.review-workflows.list.page.create",defaultMessage:"Create new workflow"})}),rowCount:1,children:[(0,s.jsx)(o.h,{children:(0,s.jsxs)(E.Tr,{children:[(0,s.jsx)(l.Th,{children:(0,s.jsx)(i.Z,{variant:"sigma",children:a({id:"Settings.review-workflows.list.page.list.column.name.title",defaultMessage:"Name"})})}),(0,s.jsx)(l.Th,{children:(0,s.jsx)(i.Z,{variant:"sigma",children:a({id:"Settings.review-workflows.list.page.list.column.stages.title",defaultMessage:"Stages"})})}),(0,s.jsx)(l.Th,{children:(0,s.jsx)(i.Z,{variant:"sigma",children:a({id:"Settings.review-workflows.list.page.list.column.contentTypes.title",defaultMessage:"Content Types"})})}),(0,s.jsx)(l.Th,{children:(0,s.jsx)(m.T,{children:a({id:"Settings.review-workflows.list.page.list.column.actions.title",defaultMessage:"Actions"})})})]})}),(0,s.jsx)(n.p,{children:Z.map(r=>(0,M.createElement)(E.Tr,{...(0,e.onRowClick)({fn(R){R.target.nodeName!=="BUTTON"&&k(`/settings/review-workflows/${r.id}`)}}),key:`workflow-${r.id}`},(0,s.jsx)(l.Td,{width:(0,e.pxToRem)(250),children:(0,s.jsx)(i.Z,{textColor:"neutral800",fontWeight:"bold",ellipsis:!0,children:r.name})}),(0,s.jsx)(l.Td,{children:(0,s.jsx)(i.Z,{textColor:"neutral800",children:r.stages.length})}),(0,s.jsx)(l.Td,{children:(0,s.jsx)(i.Z,{textColor:"neutral800",children:(r?.contentTypes??[]).map(_t).join(", ")})}),(0,s.jsx)(l.Td,{children:(0,s.jsxs)(c.k,{alignItems:"center",justifyContent:"end",children:[(0,s.jsx)(G,{to:`/settings/review-workflows/${r.id}`,"aria-label":a({id:"Settings.review-workflows.list.page.list.column.actions.edit.label",defaultMessage:"Edit {name}"},{name:r.name}),children:(0,s.jsx)(w.Z,{})}),Z.length>1&&it&&(0,s.jsx)(y.h,{"aria-label":a({id:"Settings.review-workflows.list.page.list.column.actions.delete.label",defaultMessage:"Delete {name}"},{name:"Default workflow"}),icon:(0,s.jsx)(x.Z,{}),noBorder:!0,onClick:()=>{dt(r.id)}})]})})))})]}),(0,s.jsx)(e.ConfirmDialog,{bodyText:{id:"Settings.review-workflows.list.page.delete.confirm.body",defaultMessage:"If you remove this worfklow, all stage-related information will be removed for this content-type. Are you sure you want to remove it?"},isConfirmButtonLoading:lt,isOpen:!!N,onToggleDialog:Et,onConfirm:ct}),(0,s.jsxs)(U.L,{isOpen:st,onClose:()=>I(!1),children:[(0,s.jsx)(U.T,{children:a({id:"Settings.review-workflows.list.page.workflows.limit.title",defaultMessage:"You\u2019ve reached the limit of workflows in your plan"})}),(0,s.jsx)(U.B,{children:a({id:"Settings.review-workflows.list.page.workflows.limit.body",defaultMessage:"Delete a workflow or contact Sales to enable more workflows."})})]})]})]})}function Y(){const a=(0,D.useSelector)(P.s);return(0,s.jsx)(e.CheckPagePermissions,{permissions:a.settings["review-workflows"].main,children:(0,s.jsx)(J,{})})}},59491:(h,f,t)=>{t.d(f,{u:()=>M});var s=t(27279),e=t(1180),D=t(53532),P=t(40464);function M(){const{get:c}=(0,e.useFetchClient)(),{formatAPIError:_}=(0,e.useAPIErrorHandler)(),d=(0,e.useNotification)(),O=(0,P.useQueries)([{queryKey:["content-manager","components"],async queryFn(){const{data:{data:n}}=await c("/content-manager/components");return n},onError(n){n instanceof D.d7&&d({type:"warning",message:_(n)})}},{queryKey:["content-manager","content-types"],async queryFn(){const{data:{data:n}}=await c("/content-manager/content-types");return n},onError(n){n instanceof D.d7&&d({type:"warning",message:_(n)})}}]),[o,E]=O,l=o.isLoading||E.isLoading,i=s.useMemo(()=>(E?.data??[]).filter(n=>n.kind==="collectionType"&&n.isDisplayed),[E?.data]),m=s.useMemo(()=>(E?.data??[]).filter(n=>n.kind!=="collectionType"&&n.isDisplayed),[E?.data]);return{isLoading:l,components:s.useMemo(()=>o?.data??[],[o?.data]),collectionTypes:i,singleTypes:m}}},88181:(h,f,t)=>{t.d(f,{u:()=>P});var s=t(27279),e=t(1180),D=t(40464);function P(M={}){const{get:c}=(0,e.useFetchClient)(),{id:_="",...d}=M,O={populate:"stages"},{data:o,isLoading:E,status:l,refetch:i}=(0,D.useQuery)(["review-workflows","workflows",_],async()=>(await c(`/admin/review-workflows/workflows/${_}`,{params:{...O,...d}})).data),m=s.useMemo(()=>_&&o?.data?[o.data]:Array.isArray(o?.data)?o.data:[],[o?.data,_]);return{meta:s.useMemo(()=>o?.meta??{},[o?.meta]),workflows:m,isLoading:E,status:l,refetch:i}}},53532:(h,f,t)=>{t.d(f,{d7:()=>D});var s=t(5466);const{Axios:e,AxiosError:D,CanceledError:P,isCancel:M,CancelToken:c,VERSION:_,all:d,Cancel:O,isAxiosError:o,spread:E,toFormData:l,AxiosHeaders:i,HttpStatusCode:m,formToJSON:n,getAdapter:y,mergeConfig:T}=s.default}}]);
