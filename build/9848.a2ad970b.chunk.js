"use strict";(self.webpackChunkstrapi=self.webpackChunkstrapi||[]).push([[9848],{11745:(F,v,s)=>{s.d(v,{a:()=>u,g:()=>O});var t=s(97003),a=s(47706);function O(E){if(!E)return null;const W=Object.entries(t.W.colors).filter(([,P])=>P.toUpperCase()===E.toUpperCase()).reduce((P,[U])=>(a.S?.[U]&&(P=U),P),null);return W?{themeColorName:W,name:a.S[W]}:null}function u(){return Object.entries(a.S).map(([E,f])=>({hex:t.W.colors[E].toUpperCase(),name:f}))}},42551:(F,v,s)=>{s.d(v,{A:()=>a,S:()=>t});const t="strapi_stage",a="strapi_assignee"},99848:(F,v,s)=>{s.r(v),s.d(v,{InformationBoxEE:()=>ss});var t=s(74081),a=s(1180),O=s(55605),u=s(1821),E=s(10701),f=s(8295),W=s(61121),P=s(63738),U=s(21395),Y=s(77970),Z=s(67588),z=s(55911),w=s(61020),x=s(40464),G=s(49402),ts=s(8175),as=s(98934),ns=s(74919),es=s(92249),os=s(52058),_s=s(87830),ls=s(43433),Q=s(11266),J=s(44328),e=s(42551),S=s(27279),X=s(66360),h=s(78099),K=s(47706),V=s(11745),Es=s(51006),is=s(364),rs=s(76368),ds=s(3243),Ms=s(29206),Ds=s(6078),Os=s(51943),Ps=s(92401),gs=s(15816),ms=s(97442),cs=s(13576),Cs=s(47184),vs=s(71563),hs=s(49204),As=s(47853),Is=s(75719),Ws=s(84921),Ls=s(41942),Ts=s(4828),Bs=s(22919),Rs=s(53915),us=s(75041),fs=s(30200),Us=s(91379),Ks=s(33299),ys=s(33409),js=s(63645),xs=s(7988),Ss=s(7055),Ns=s(26757),$s=s(58311),ps=s(29510),Fs=s(79146),ws=s(16946),Vs=s(10124),Hs=s(69530),Ys=s(19764),Zs=s(42982),zs=s(26126),Gs=s(80481),Qs=s(81465),Js=s(37997),Xs=s(63799),ks=s(86961),bs=s(51527),qs=s(64797),st=s(85811);function k(){const{initialData:_,layout:{uid:r},isSingleType:g,onChange:L}=(0,a.useCMEditViewDataManager)(),T=(0,G.useSelector)(J.s),{formatMessage:n}=(0,w.Z)(),{formatAPIError:B}=(0,a.useAPIErrorHandler)(),M=(0,a.useNotification)(),{put:R}=(0,a.useFetchClient)(),{allowedActions:{canReadUsers:d},isLoading:m}=(0,a.useRBAC)({readUsers:T.settings.users.read}),{users:A,isLoading:I,isError:y}=(0,Q.u)({},{enabled:!m&&d}),c=_?.[e.A]??null,C=async({value:o})=>{l.mutate({entityId:_.id,assigneeId:parseInt(o,10),uid:r})},l=(0,x.useMutation)(async({entityId:o,assigneeId:N,uid:$})=>{const i=g?"single-types":"collection-types",{data:{data:D}}=await R(`/admin/content-manager/${i}/${$}/${o}/assignee`,{data:{id:N}});return L({target:{name:e.A,value:D[e.A]}},!0),D},{onSuccess(){M({type:"success",message:{id:"content-manager.reviewWorkflows.assignee.notification.saved",defaultMessage:"Assignee updated"}})}});return(0,t.jsx)(u.g,{name:e.A,id:e.A,children:(0,t.jsx)(E.k,{direction:"column",gap:2,alignItems:"stretch",children:(0,t.jsx)(f.hQ,{clearLabel:n({id:"content-manager.reviewWorkflows.assignee.clear",defaultMessage:"Clear assignee"}),error:y&&d&&n({id:"content-manager.reviewWorkflows.assignee.error",defaultMessage:"An error occurred while fetching users"})||l.error&&B(l.error),disabled:!m&&!I&&A.length===0,name:e.A,id:e.A,value:c?c.id:null,onChange:o=>C({value:o}),onClear:()=>C({value:null}),placeholder:n({id:"content-manager.reviewWorkflows.assignee.placeholder",defaultMessage:"Select \u2026"}),label:n({id:"content-manager.reviewWorkflows.assignee.label",defaultMessage:"Assignee"}),loading:I||m||l.isLoading,children:A.map(o=>(0,t.jsx)(W.O,{value:o.id,textValue:(0,O.g)(o,n),children:(0,O.g)(o,n)},o.id))})})})}function b({id:_,layout:r}={},g={}){const{kind:L,uid:T}=r,n=L==="collectionType"?"collection-types":"single-types",{get:B}=(0,a.useFetchClient)(),{data:M,isLoading:R,refetch:d}=(0,x.useQuery)(["content-manager",n,r.uid,_,"stages"],async()=>{const{data:I}=await B(`/admin/content-manager/${n}/${T}/${_}/stages`);return I},g),m=S.useMemo(()=>M?.meta??{},[M?.meta]),A=S.useMemo(()=>M?.data??[],[M?.data]);return{meta:m,stages:A,isLoading:R,refetch:d}}function q(){const{initialData:_,layout:r,isSingleType:g,onChange:L}=(0,a.useCMEditViewDataManager)(),{put:T}=(0,a.useFetchClient)(),{formatMessage:n}=(0,w.Z)(),{formatAPIError:B}=(0,a.useAPIErrorHandler)(),M=(0,a.useNotification)(),{meta:R,stages:d,isLoading:m,refetch:A}=b({id:_.id,layout:r},{enabled:!!_?.id}),{getFeature:I}=(0,X.u)(),[y,c]=S.useState(!1),C=I("review-workflows"),l=_?.[e.S]??null,o=(0,x.useMutation)(async({entityId:i,stageId:D,uid:j})=>{const p=g?"single-types":"collection-types",{data:{data:H}}=await T(`/admin/content-manager/${p}/${j}/${i}/stage`,{data:{id:D}});return L({target:{name:e.S,value:H[e.S]}},!0),await A(),H},{onSuccess(){M({type:"success",message:{id:"content-manager.reviewWorkflows.stage.notification.saved",defaultMessage:"Review stage updated"}})}}),N=async({value:i})=>{try{C?.[K.C]&&parseInt(C[K.C],10)<R.workflowCount?c("workflow"):C?.[K.a]&&parseInt(C[K.a],10)<d.length?c("stage"):o.mutateAsync({entityId:_.id,stageId:i,uid:r.uid})}catch{}},{themeColorName:$}=l?.color?(0,V.g)(l?.color):{};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.g,{hint:d.length===0&&n({id:"content-manager.reviewWorkflows.stages.no-transition",defaultMessage:"You don\u2019t have the permission to update this stage."}),name:e.S,id:e.S,children:(0,t.jsxs)(E.k,{direction:"column",gap:2,alignItems:"stretch",children:[(0,t.jsx)(P.q4,{disabled:d.length===0,error:o.error&&B(o.error)||null,name:e.S,id:e.S,value:l?.id,onChange:i=>N({value:i}),label:n({id:"content-manager.reviewWorkflows.stage.label",defaultMessage:"Review stage"}),startIcon:l&&(0,t.jsx)(E.k,{as:"span",height:2,background:l?.color,borderColor:$==="neutral0"?"neutral150":"transparent",hasRadius:!0,shrink:0,width:2,marginRight:"-3px"}),customizeContent:()=>(0,t.jsxs)(E.k,{as:"span",justifyContent:"space-between",alignItems:"center",width:"100%",children:[(0,t.jsx)(U.Z,{textColor:"neutral800",ellipsis:!0,children:l?.name??""}),m?(0,t.jsx)(Y.a,{small:!0,style:{display:"flex"},"data-testid":"loader"}):null]}),children:d.map(({id:i,color:D,name:j})=>{const{themeColorName:p}=(0,V.g)(D);return(0,t.jsx)(P.ag,{startIcon:(0,t.jsx)(E.k,{height:2,background:D,borderColor:p==="neutral0"?"neutral150":"transparent",hasRadius:!0,shrink:0,width:2}),value:i,textValue:j,children:j},i)})}),(0,t.jsx)(Z.J,{}),(0,t.jsx)(z.c,{})]})}),(0,t.jsxs)(h.L,{isOpen:y==="workflow",onClose:()=>c(!1),children:[(0,t.jsx)(h.T,{children:n({id:"content-manager.reviewWorkflows.workflows.limit.title",defaultMessage:"You\u2019ve reached the limit of workflows in your plan"})}),(0,t.jsx)(h.B,{children:n({id:"content-manager.reviewWorkflows.workflows.limit.body",defaultMessage:"Delete a workflow or contact Sales to enable more workflows."})})]}),(0,t.jsxs)(h.L,{isOpen:y==="stage",onClose:()=>c(!1),children:[(0,t.jsx)(h.T,{children:n({id:"content-manager.reviewWorkflows.stages.limit.title",defaultMessage:"You have reached the limit of stages for this workflow in your plan"})}),(0,t.jsx)(h.B,{children:n({id:"content-manager.reviewWorkflows.stages.limit.body",defaultMessage:"Try deleting some stages or contact Sales to enable more stages."})})]})]})}function ss(){const{isCreatingEntry:_,layout:{options:r}}=(0,a.useCMEditViewDataManager)(),g=r?.reviewWorkflows??!1;return(0,t.jsxs)(O.I.Root,{children:[(0,t.jsx)(O.I.Title,{}),g&&!_&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(q,{}),(0,t.jsx)(k,{})]}),(0,t.jsx)(O.I.Body,{})]})}}}]);
