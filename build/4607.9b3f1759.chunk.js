"use strict";(self.webpackChunkstrapi=self.webpackChunkstrapi||[]).push([[4607],{84607:(je,U,s)=>{s.r(U),s.d(U,{default:()=>Le});var e=s(74081),_=s(1180),l=s(73180),D=s(27279),d=s(70627),W=s(22572),ae=s(51926),te=s(8295),le=s(61121),K=s(23298),L=s(74577),N=s(12881),Z=s(5938),F=s(6918),h=s(21395),b=s(15244),z=s(69878),O=s(10701),P=s(94098),V=s(84366),$=s(93415),x=s(61908),J=s(35250),y=s(48102),ie=s(5627),ne=s(78955),oe=s(70774),de=s(38101),Q=s(93153),M=s(50086),ce=s(10989),re=s(86967),X=s(4987),ge=s(73354),_e=s(27875),ue=s(74758),me=s(6191),G=s(59082),he=s(26784),Ee=s(78665),H=s(36938),De=s(52448),E=s(61020),v=s(71563),Me=s(98934),j=s(49402),T=s(47853),fe=s(40464),Te=s(10131),Re=s(29206),Ae=s(43433),Be=s(8175),Ie=s(87830),Se=s(74919);const pe=()=>{const[t,i]=(0,D.useState)(!1),n=(0,j.useDispatch)(),a=(0,_.useNotification)(),{post:o}=(0,_.useFetchClient)();return{isAdding:t,addLocale:async r=>{i(!0);try{const{data:g}=await o("/i18n/locales",r);a({type:"success",message:{id:(0,l.g)("Settings.locales.modal.create.success")}}),n({type:l.A,newLocale:g})}catch(g){const u=Me(g,"response.payload.message",null);throw u&&u.includes("already exists")?a({type:"warning",message:{id:(0,l.g)("Settings.locales.modal.create.alreadyExist")}}):a({type:"warning",message:{id:"notification.error"}}),g}finally{i(!1)}}}},Y=(0,T.Ry)().shape({code:(0,T.Z_)().required(),displayName:(0,T.Z_)().max(50,"Settings.locales.modal.locales.displayName.error").required(_.translatedErrors.required)}),Pe=()=>{const{values:t,setFieldValue:i}=(0,v.u6)(),{formatMessage:n}=(0,E.Z)();return(0,e.jsx)(W.X,{hint:n({id:(0,l.g)("Settings.locales.modal.advanced.setAsDefault.hint"),defaultMessage:"One default locale is required, change it by selecting another one"}),onChange:()=>i("isDefault",!t.isDefault),value:t.isDefault,children:n({id:(0,l.g)("Settings.locales.modal.advanced.setAsDefault"),defaultMessage:"Set as default locale"})})},w=()=>{const{formatMessage:t}=(0,E.Z)(),{notifyStatus:i}=(0,ae.G)(),n=(0,_.useNotification)(),{get:a}=(0,_.useFetchClient)(),{isLoading:o,data:c}=(0,fe.useQuery)(["plugin-i18n","locales"],async()=>{try{const{data:r}=await a("/i18n/iso-locales");return i(t({id:(0,l.g)("Settings.locales.modal.locales.loaded"),defaultMessage:"The locales have been successfully loaded."})),r}catch{return n({type:"warning",message:{id:"notification.error"}}),[]}});return{defaultLocales:c,isLoading:o}},R=D.memo(({value:t,onClear:i,onLocaleChange:n,error:a})=>{const{formatMessage:o}=(0,E.Z)(),{defaultLocales:c,isLoading:r}=w(),{locales:g}=(0,l.u)(),u=(c||[]).map(m=>({label:m.name,value:m.code})).filter(({value:m})=>{const f=g.find(({code:C})=>C===m);return!f||f.code===t}),p=t||"";return(0,e.jsx)(te.hQ,{"aria-busy":r,error:a,label:o({id:(0,l.g)("Settings.locales.modal.locales.label"),defaultMessage:"Locales"}),value:p,onClear:t?i:void 0,onChange:m=>{const f=u.find(C=>C.value===m);f&&n({code:f.value,displayName:f.label})},placeholder:o({id:"components.placeholder.select",defaultMessage:"Select"}),children:u.map(m=>(0,e.jsx)(le.O,{value:m.value,children:m.label},m.value))})});R.defaultProps={error:void 0,value:void 0,onClear(){},onLocaleChange:()=>{}},R.propTypes={error:d.string,onClear:d.func,onLocaleChange:d.func,value:d.string};const xe=()=>{const{formatMessage:t}=(0,E.Z)(),{values:i,handleChange:n,setFieldValue:a,errors:o}=(0,v.u6)(),c=(0,D.useCallback)(g=>{a("displayName",g.displayName),a("code",g.code)},[a]),r=(0,D.useCallback)(()=>{a("displayName",""),a("code","")},[a]);return(0,e.jsxs)(K.r,{gap:4,children:[(0,e.jsx)(L.P,{col:6,children:(0,e.jsx)(R,{error:o.code,value:i.code,onLocaleChange:c,onClear:r})}),(0,e.jsx)(L.P,{col:6,children:(0,e.jsx)(N.o,{name:"displayName",label:t({id:(0,l.g)("Settings.locales.modal.locales.displayName"),defaultMessage:"Locale display name"}),hint:t({id:(0,l.g)("Settings.locales.modal.locales.displayName.description"),defaultMessage:"Locale will be displayed under that name in the administration panel"}),error:o.displayName?t({id:(0,l.g)("Settings.locales.modal.locales.displayName.error"),defaultMessage:"The locale display name can only be less than 50 characters."}):void 0,value:i.displayName,onChange:n})})]})},ye={code:"",displayName:"",isDefault:!1},q=({onClose:t})=>{const{isAdding:i,addLocale:n}=pe(),{formatMessage:a}=(0,E.Z)(),{refetchPermissions:o}=(0,_.useRBACProvider)(),c=async r=>{await n({code:r.code,name:r.displayName,isDefault:r.isDefault}),await o()};return(0,e.jsx)(Z.P,{onClose:t,labelledBy:"add-locale-title",children:(0,e.jsx)(v.J9,{initialValues:ye,onSubmit:c,validationSchema:Y,validateOnChange:!1,children:(0,e.jsxs)(_.Form,{children:[(0,e.jsx)(F.x,{children:(0,e.jsx)(h.Z,{fontWeight:"bold",textColor:"neutral800",as:"h2",id:"add-locale-title",children:a({id:(0,l.g)("Settings.list.actions.add"),defaultMessage:"Add new locale"})})}),(0,e.jsx)(b.f,{children:(0,e.jsxs)(z.v,{label:a({id:(0,l.g)("Settings.locales.modal.title"),defaultMessage:"Configurations"}),id:"tabs",variant:"simple",children:[(0,e.jsxs)(O.k,{justifyContent:"space-between",children:[(0,e.jsx)(h.Z,{as:"h2",variant:"beta",children:a({id:(0,l.g)("Settings.locales.modal.title"),defaultMessage:"Configurations"})}),(0,e.jsxs)(P.m,{children:[(0,e.jsx)(P.O,{children:a({id:(0,l.g)("Settings.locales.modal.base"),defaultMessage:"Basic settings"})}),(0,e.jsx)(P.O,{children:a({id:(0,l.g)("Settings.locales.modal.advanced"),defaultMessage:"Advanced settings"})})]})]}),(0,e.jsx)(V.i,{}),(0,e.jsx)($.x,{paddingTop:7,paddingBottom:7,children:(0,e.jsxs)(x.n,{children:[(0,e.jsx)(x.x,{children:(0,e.jsx)(xe,{})}),(0,e.jsx)(x.x,{children:(0,e.jsx)(Pe,{})})]})})]})}),(0,e.jsx)(J.m,{startActions:(0,e.jsx)(y.z,{variant:"tertiary",onClick:t,children:a({id:"app.components.Button.cancel",defaultMessage:"Cancel"})}),endActions:(0,e.jsx)(y.z,{type:"submit",startIcon:(0,e.jsx)(G.Z,{}),disabled:i,children:a({id:"global.save",defaultMessage:"Save"})})})]})})})};q.propTypes={onClose:d.func.isRequired};const ve=()=>{const[t,i]=(0,D.useState)(!1),n=(0,j.useDispatch)(),a=(0,_.useNotification)(),{del:o}=(0,_.useFetchClient)();return{isDeleting:t,deleteLocale:async r=>{try{i(!0),await o(`/i18n/locales/${r}`),a({type:"success",message:{id:(0,l.g)("Settings.locales.modal.delete.success")}}),n({type:l.D,id:r})}catch{a({type:"warning",message:{id:"notification.error"}})}finally{i(!1)}}}},A=({localeToDelete:t,onClose:i})=>{const{isDeleting:n,deleteLocale:a}=ve(),o=Boolean(t),c=()=>a(t.id).then(i);return(0,e.jsx)(_.ConfirmDialog,{isConfirmButtonLoading:n,onConfirm:c,onToggleDialog:i,isOpen:o})};A.defaultProps={localeToDelete:void 0},A.propTypes={localeToDelete:d.shape({id:d.number.isRequired}),onClose:d.func.isRequired};const Ce=()=>{const[t,i]=(0,D.useState)(!1),n=(0,j.useDispatch)(),a=(0,_.useNotification)(),{put:o}=(0,_.useFetchClient)();return{isEditing:t,editLocale:async(r,g)=>{try{i(!0);const{data:u}=await o(`/i18n/locales/${r}`,g);a({type:"success",message:{id:(0,l.g)("Settings.locales.modal.edit.success")}}),n({type:l.U,editedLocale:u})}catch{a({type:"warning",message:{id:"notification.error"}})}finally{i(!1)}}}},k=({isDefaultLocale:t})=>{const{values:i,setFieldValue:n}=(0,v.u6)(),{formatMessage:a}=(0,E.Z)();return(0,e.jsx)(W.X,{name:"isDefault",hint:a({id:(0,l.g)("Settings.locales.modal.advanced.setAsDefault.hint"),defaultMessage:"One default locale is required, change it by selecting another one"}),onChange:()=>n("isDefault",!i.isDefault),value:i.isDefault,disabled:t,children:a({id:(0,l.g)("Settings.locales.modal.advanced.setAsDefault"),defaultMessage:"Set as default locale"})})};k.propTypes={isDefaultLocale:d.bool.isRequired};const ee=({locale:t})=>{const{formatMessage:i}=(0,E.Z)(),{values:n,handleChange:a,errors:o}=(0,v.u6)(),{defaultLocales:c,isLoading:r}=w(),g=!r&&c.find(u=>u.code===t.code);return(0,e.jsxs)(K.r,{gap:4,children:[(0,e.jsx)(L.P,{col:6,children:(0,e.jsx)(ie.P,{label:i({id:(0,l.g)("Settings.locales.modal.locales.label"),defaultMessage:"Locales"}),value:g?.code||t.code,disabled:!0,children:(0,e.jsx)(ne.W,{value:g?.code||t.code,children:g?.name||t.code})})}),(0,e.jsx)(L.P,{col:6,children:(0,e.jsx)(N.o,{name:"displayName",label:i({id:(0,l.g)("Settings.locales.modal.locales.displayName"),defaultMessage:"Locale display name"}),hint:i({id:(0,l.g)("Settings.locales.modal.locales.displayName.description"),defaultMessage:"Locale will be displayed under that name in the administration panel"}),error:o.displayName?i({id:(0,l.g)("Settings.locales.modal.locales.displayName.error"),defaultMessage:"The locale display name can only be less than 50 characters."}):void 0,value:n.displayName,onChange:a})})]})};ee.propTypes={locale:d.shape({id:d.number.isRequired,name:d.string.isRequired,code:d.string.isRequired,isDefault:d.bool.isRequired}).isRequired};const B=({locale:t,onClose:i})=>{const{refetchPermissions:n}=(0,_.useRBACProvider)(),{isEditing:a,editLocale:o}=Ce(),{formatMessage:c}=(0,E.Z)(),r=async({displayName:g,isDefault:u})=>{await o(t.id,{name:g,isDefault:u}),await n()};return(0,e.jsx)(Z.P,{onClose:i,labelledBy:"edit-locale-title",children:(0,e.jsx)(v.J9,{initialValues:{code:t?.code,displayName:t?.name||"",isDefault:Boolean(t?.isDefault)},onSubmit:r,validationSchema:Y,children:(0,e.jsxs)(_.Form,{children:[(0,e.jsx)(F.x,{children:(0,e.jsx)(h.Z,{fontWeight:"bold",textColor:"neutral800",as:"h2",id:"edit-locale-title",children:c({id:(0,l.g)("Settings.list.actions.edit"),defaultMessage:"Edit a locale"})})}),(0,e.jsx)(b.f,{children:(0,e.jsxs)(z.v,{label:c({id:(0,l.g)("Settings.locales.modal.title"),defaultMessage:"Configurations"}),id:"tabs",variant:"simple",children:[(0,e.jsxs)(O.k,{justifyContent:"space-between",children:[(0,e.jsx)(h.Z,{as:"h2",children:c({id:(0,l.g)("Settings.locales.modal.title"),defaultMessage:"Configurations"})}),(0,e.jsxs)(P.m,{children:[(0,e.jsx)(P.O,{children:c({id:(0,l.g)("Settings.locales.modal.base"),defaultMessage:"Basic settings"})}),(0,e.jsx)(P.O,{children:c({id:(0,l.g)("Settings.locales.modal.advanced"),defaultMessage:"Advanced settings"})})]})]}),(0,e.jsx)(V.i,{}),(0,e.jsx)($.x,{paddingTop:7,paddingBottom:7,children:(0,e.jsxs)(x.n,{children:[(0,e.jsx)(x.x,{children:(0,e.jsx)(ee,{locale:t})}),(0,e.jsx)(x.x,{children:(0,e.jsx)(k,{isDefaultLocale:Boolean(t&&t.isDefault)})})]})})]})}),(0,e.jsx)(J.m,{startActions:(0,e.jsx)(y.z,{variant:"tertiary",onClick:i,children:c({id:"app.components.Button.cancel"})}),endActions:(0,e.jsx)(y.z,{type:"submit",startIcon:(0,e.jsx)(G.Z,{}),disabled:a,children:c({id:"global.save"})})})]})})})};B.defaultProps={locale:void 0},B.propTypes={locale:d.shape({id:d.number.isRequired,name:d.string.isRequired,code:d.string.isRequired,isDefault:d.bool.isRequired}),onClose:d.func.isRequired};const I=({locales:t,onDeleteLocale:i,onEditLocale:n})=>{const{formatMessage:a}=(0,E.Z)();return(0,e.jsxs)(oe.i,{colCount:4,rowCount:t.length+1,children:[(0,e.jsx)(de.h,{children:(0,e.jsxs)(Q.Tr,{children:[(0,e.jsx)(M.Th,{children:(0,e.jsx)(h.Z,{variant:"sigma",textColor:"neutral600",children:a({id:(0,l.g)("Settings.locales.row.id")})})}),(0,e.jsx)(M.Th,{children:(0,e.jsx)(h.Z,{variant:"sigma",textColor:"neutral600",children:a({id:(0,l.g)("Settings.locales.row.displayName")})})}),(0,e.jsx)(M.Th,{children:(0,e.jsx)(h.Z,{variant:"sigma",textColor:"neutral600",children:a({id:(0,l.g)("Settings.locales.row.default-locale")})})}),(0,e.jsx)(M.Th,{children:(0,e.jsx)(ce.T,{children:"Actions"})})]})}),(0,e.jsx)(re.p,{children:t.map(o=>(0,e.jsxs)(Q.Tr,{...(0,_.onRowClick)({fn:()=>n(o),condition:n}),children:[(0,e.jsx)(M.Td,{children:(0,e.jsx)(h.Z,{textColor:"neutral800",children:o.id})}),(0,e.jsx)(M.Td,{children:(0,e.jsx)(h.Z,{textColor:"neutral800",children:o.name})}),(0,e.jsx)(M.Td,{children:(0,e.jsx)(h.Z,{textColor:"neutral800",children:o.isDefault?a({id:(0,l.g)("Settings.locales.default")}):null})}),(0,e.jsx)(M.Td,{children:(0,e.jsxs)(O.k,{gap:1,justifyContent:"flex-end",..._.stopPropagation,children:[n&&(0,e.jsx)(X.h,{onClick:()=>n(o),label:a({id:(0,l.g)("Settings.list.actions.edit")}),icon:(0,e.jsx)(he.Z,{}),noBorder:!0}),i&&!o.isDefault&&(0,e.jsx)(X.h,{onClick:()=>i(o),label:a({id:(0,l.g)("Settings.list.actions.delete")}),icon:(0,e.jsx)(Ee.Z,{}),noBorder:!0})]})})]},o.id))})]})};I.defaultProps={locales:[],onDeleteLocale:void 0,onEditLocale:void 0},I.propTypes={locales:d.array,onDeleteLocale:d.func,onEditLocale:d.func};const S=({canUpdateLocale:t,canDeleteLocale:i,onToggleCreateModal:n,isCreating:a})=>{const[o,c]=(0,D.useState)(),[r,g]=(0,D.useState)(),{locales:u}=(0,l.u)(),{formatMessage:p}=(0,E.Z)();(0,_.useFocusWhenNavigate)();const m=()=>c(void 0),f=i?c:void 0,C=()=>g(void 0),Oe=t?g:void 0;return(0,e.jsxs)(ge.o,{tabIndex:-1,children:[(0,e.jsx)(_e.T,{primaryAction:(0,e.jsx)(y.z,{startIcon:(0,e.jsx)(H.Z,{}),onClick:n,size:"S",children:p({id:(0,l.g)("Settings.list.actions.add")})}),title:p({id:(0,l.g)("plugin.name")}),subtitle:p({id:(0,l.g)("Settings.list.description")})}),(0,e.jsx)(ue.D,{children:u?.length>0?(0,e.jsx)(I,{locales:u,onDeleteLocale:f,onEditLocale:Oe}):(0,e.jsx)(me.x,{icon:(0,e.jsx)(De.Z,{width:void 0,height:void 0}),content:p({id:(0,l.g)("Settings.list.empty.title")}),action:n?(0,e.jsx)(y.z,{variant:"secondary",startIcon:(0,e.jsx)(H.Z,{}),onClick:n,children:p({id:(0,l.g)("Settings.list.actions.add")})}):null})}),a&&(0,e.jsx)(q,{onClose:n}),r&&(0,e.jsx)(B,{onClose:C,locale:r}),(0,e.jsx)(A,{localeToDelete:o,onClose:m})]})};S.defaultProps={onToggleCreateModal:void 0},S.propTypes={canUpdateLocale:d.bool.isRequired,canDeleteLocale:d.bool.isRequired,onToggleCreateModal:d.func,isCreating:d.bool.isRequired};const se=({canReadLocale:t,canCreateLocale:i,canDeleteLocale:n,canUpdateLocale:a})=>{const[o,c]=(0,D.useState)(!1),r=i?()=>c(g=>!g):void 0;return t?(0,e.jsx)(S,{canUpdateLocale:a,canDeleteLocale:n,onToggleCreateModal:r,isCreating:o}):null};se.propTypes={canReadLocale:d.bool.isRequired,canCreateLocale:d.bool.isRequired,canUpdateLocale:d.bool.isRequired,canDeleteLocale:d.bool.isRequired};const Le=()=>{const{isLoading:t,allowedActions:{canRead:i,canUpdate:n,canCreate:a,canDelete:o}}=(0,_.useRBAC)(l.P);return t?null:(0,e.jsx)(se,{canReadLocale:i,canCreateLocale:a,canUpdateLocale:n,canDeleteLocale:o})}}}]);
