"use strict";(self.webpackChunkstrapi=self.webpackChunkstrapi||[]).push([[6895],{56895:(ms,W,t)=>{t.r(W),t.d(W,{default:()=>is});var s=t(74081),o=t(1180),f=t(49402),u=t(44328),P=t(27279),z=t(51926),F=t(27997),V=t(73354),G=t(27875),H=t(37472),_=t(21395),B=t(48102),Q=t(74758),Y=t(93415),J=t(70774),X=t(38566),k=t(38101),I=t(93153),i=t(50086),R=t(73411),w=t(10989),q=t(86967),j=t(10701),ss=t(89053),U=t(4987),ts=t(6191),O=t(36938),K=t(78665),es=t(26784),as=t(52448),ns=t(61020),c=t(40464),y=t(51447),vs=t(64797),Ls=t(85811),xs=t(92401),As=t(15816),Ws=t(97442),fs=t(13576),us=t(87830),Bs=t(47184),Is=t(364),Rs=t(71563),js=t(49204),Us=t(47853),Ks=t(75719),ys=t(74919),Ss=t(29206),ps=t(98934),bs=t(43433),Zs=t(8175);const os=()=>{const[C,E]=(0,P.useState)(!1),[T,l]=(0,P.useState)([]),_s=(0,f.useSelector)(u.s),{formatMessage:a}=(0,ns.Z)(),{formatAPIError:M}=(0,o.useAPIErrorHandler)(),h=(0,o.useNotification)();(0,o.useFocusWhenNavigate)();const{push:ls}=(0,y.k6)(),{pathname:S}=(0,y.TH)(),{isLoading:ds,allowedActions:{canCreate:m,canUpdate:p,canDelete:b}}=(0,o.useRBAC)(_s.settings.webhooks),{get:Es,post:rs,put:Ms}=(0,o.useFetchClient)(),{notifyStatus:Z}=(0,z.G)(),hs="webhooks",{isLoading:gs,data:d,error:v,refetch:$}=(0,c.useQuery)(hs,async()=>{const{data:{data:e}}=await Es("/admin/webhooks");return e});(0,P.useEffect)(()=>{if(v){h({type:"warning",message:M(v)});return}d&&Z(a({id:"Settings.webhooks.list.loading.success",defaultMessage:"Webhooks have been loaded"}))},[d,v,h,a,Z,M]);const N=(0,c.useMutation)(async()=>{await rs("/admin/webhooks/batch-delete",{ids:T})},{onError(e){h({type:"warning",message:M(e)}),E(!1)},onSuccess(){l([]),E(!1),$()}}),Ds=(0,c.useMutation)(async({isEnabled:e,id:n})=>{const{id:D,...A}=d.find(Ts=>Ts.id===n)??{},Cs={...A,isEnabled:e};await Ms(`/admin/webhooks/${n}`,Cs)},{onError(e){h({type:"warning",message:M(e)})},onSuccess(){$()}}),Ps=()=>N.mutate(),Os=e=>l(e?d.map(n=>n.id):[]),cs=(e,n)=>l(e?D=>[...D,n]:D=>D.filter(A=>A!==n)),L=e=>ls(`${S}/${e}`),x=ds||gs,g=d?.length??0,r=T.length;return(0,s.jsxs)(F.A,{children:[(0,s.jsx)(o.SettingsPageTitle,{name:"Webhooks"}),(0,s.jsxs)(V.o,{"aria-busy":x,children:[(0,s.jsx)(G.T,{title:a({id:"Settings.webhooks.title",defaultMessage:"Webhooks"}),subtitle:a({id:"Settings.webhooks.list.description",defaultMessage:"Get POST changes notifications"}),primaryAction:m&&!x&&(0,s.jsx)(o.LinkButton,{startIcon:(0,s.jsx)(O.Z,{}),variant:"default",to:`${S}/create`,size:"S",children:a({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"})})}),r>0&&b&&(0,s.jsx)(H.Z,{startActions:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(_.Z,{variant:"epsilon",textColor:"neutral600",children:a({id:"Settings.webhooks.to.delete",defaultMessage:"{webhooksToDeleteLength, plural, one {# webhook} other {# webhooks}} selected"},{webhooksToDeleteLength:r})}),(0,s.jsx)(B.z,{onClick:()=>E(!0),startIcon:(0,s.jsx)(K.Z,{}),size:"L",variant:"danger-light",children:a({id:"global.delete",defaultMessage:"Delete"})})]})}),(0,s.jsx)(Q.D,{children:x?(0,s.jsx)(Y.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:(0,s.jsx)(o.LoadingIndicatorPage,{})}):g>0?(0,s.jsxs)(J.i,{colCount:5,rowCount:g+1,footer:(0,s.jsx)(X.c,{onClick:()=>m?L("create"):{},icon:(0,s.jsx)(O.Z,{}),children:a({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"})}),children:[(0,s.jsx)(k.h,{children:(0,s.jsxs)(I.Tr,{children:[(0,s.jsx)(i.Th,{children:(0,s.jsx)(R.C,{"aria-label":a({id:"global.select-all-entries",defaultMessage:"Select all entries"}),indeterminate:r>0&&r<g,value:r===g,onValueChange:Os})}),(0,s.jsx)(i.Th,{width:"20%",children:(0,s.jsx)(_.Z,{variant:"sigma",textColor:"neutral600",children:a({id:"global.name",defaultMessage:"Name"})})}),(0,s.jsx)(i.Th,{width:"60%",children:(0,s.jsx)(_.Z,{variant:"sigma",textColor:"neutral600",children:a({id:"Settings.webhooks.form.url",defaultMessage:"URL"})})}),(0,s.jsx)(i.Th,{width:"20%",children:(0,s.jsx)(_.Z,{variant:"sigma",textColor:"neutral600",children:a({id:"Settings.webhooks.list.th.status",defaultMessage:"Status"})})}),(0,s.jsx)(i.Th,{children:(0,s.jsx)(w.T,{children:a({id:"Settings.webhooks.list.th.actions",defaultMessage:"Actions"})})})]})}),(0,s.jsx)(q.p,{children:d.map(e=>(0,s.jsxs)(I.Tr,{...(0,o.onRowClick)({fn:()=>L(e.id),condition:p}),children:[(0,s.jsx)(i.Td,{...o.stopPropagation,children:(0,s.jsx)(R.C,{"aria-label":`${a({id:"global.select",defaultMessage:"Select"})} ${e.name}`,value:T?.includes(e.id),onValueChange:n=>cs(n,e.id),name:"select"})}),(0,s.jsx)(i.Td,{children:(0,s.jsx)(_.Z,{fontWeight:"semiBold",textColor:"neutral800",children:e.name})}),(0,s.jsx)(i.Td,{children:(0,s.jsx)(_.Z,{textColor:"neutral800",children:e.url})}),(0,s.jsx)(i.Td,{children:(0,s.jsx)(j.k,{children:(0,s.jsx)(ss.r,{onLabel:a({id:"global.enabled",defaultMessage:"Enabled"}),offLabel:a({id:"global.disabled",defaultMessage:"Disabled"}),label:`${e.name} ${a({id:"Settings.webhooks.list.th.status",defaultMessage:"Status"})}`,selected:e.isEnabled,onChange:n=>{n.stopPropagation(),Ds.mutate({isEnabled:!e.isEnabled,id:e.id})},visibleLabels:!0})})}),(0,s.jsx)(i.Td,{children:(0,s.jsxs)(j.k,{gap:1,children:[p&&(0,s.jsx)(U.h,{label:a({id:"Settings.webhooks.events.update",defaultMessage:"Update"}),icon:(0,s.jsx)(es.Z,{}),noBorder:!0}),b&&(0,s.jsx)(U.h,{onClick:n=>{n.stopPropagation(),l([e.id]),E(!0)},label:a({id:"Settings.webhooks.events.delete",defaultMessage:"Delete webhook"}),icon:(0,s.jsx)(K.Z,{}),noBorder:!0})]})})]},e.id))})]}):(0,s.jsx)(ts.x,{icon:(0,s.jsx)(as.Z,{width:"160px"}),content:a({id:"Settings.webhooks.list.empty.description",defaultMessage:"No webhooks found"}),action:(0,s.jsx)(B.z,{variant:"secondary",startIcon:(0,s.jsx)(O.Z,{}),onClick:()=>m?L("create"):{},children:a({id:"Settings.webhooks.list.button.add",defaultMessage:"Create new webhook"})})})})]}),(0,s.jsx)(o.ConfirmDialog,{isOpen:C,onToggleDialog:()=>E(e=>!e),onConfirm:Ps,isConfirmButtonLoading:N.isLoading})]})},is=()=>{const C=(0,f.useSelector)(u.s);return(0,s.jsx)(o.CheckPagePermissions,{permissions:C.settings.webhooks.main,children:(0,s.jsx)(os,{})})}}}]);
