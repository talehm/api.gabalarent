(self.webpackChunkstrapi=self.webpackChunkstrapi||[]).push([[445],{67083:(m,M,s)=>{var e=s(62878);function n(o,i){var a=o==null?0:o.length;return!!a&&e(o,i,0)>-1}m.exports=n},65286:m=>{function M(s,e,n){for(var o=-1,i=s==null?0:s.length;++o<i;)if(n(e,s[o]))return!0;return!1}m.exports=M},19975:(m,M,s)=>{var e=s(44936),n=s(67083),o=s(65286),i=s(36393),a=s(20435),g=s(42435),u=200;function p(y,j,D,C){var $=-1,K=n,Z=!0,A=y.length,b=[],w=j.length;if(!A)return b;D&&(j=i(j,a(D))),C?(K=o,Z=!1):j.length>=u&&(K=g,Z=!1,j=new e(j));e:for(;++$<A;){var B=y[$],U=D==null?B:D(B);if(B=C||B!==0?B:0,Z&&U===U){for(var H=w;H--;)if(j[H]===U)continue e;b.push(B)}else K(j,U,C)||b.push(B)}return b}m.exports=p},1107:(m,M,s)=>{var e=s(84856),n=s(52593),o=n(e);m.exports=o},32652:m=>{function M(s,e,n,o){for(var i=s.length,a=n+(o?1:-1);o?a--:++a<i;)if(e(s[a],a,s))return a;return-1}m.exports=M},62878:(m,M,s)=>{var e=s(32652),n=s(2784),o=s(51425);function i(a,g,u){return g===g?o(a,g,u):e(a,n,u)}m.exports=i},2784:m=>{function M(s){return s!==s}m.exports=M},92403:(m,M,s)=>{var e=s(1107),n=s(47727);function o(i,a){var g=-1,u=n(i)?Array(i.length):[];return e(i,function(p,y,j){u[++g]=a(p,y,j)}),u}m.exports=o},16429:(m,M,s)=>{var e=s(36393),n=s(82393),o=s(90040),i=s(92403),a=s(63135),g=s(20435),u=s(9998),p=s(51339),y=s(26126);function j(D,C,$){C.length?C=e(C,function(A){return y(A)?function(b){return n(b,A.length===1?A[0]:A)}:A}):C=[p];var K=-1;C=e(C,g(o));var Z=i(D,function(A,b,w){var B=e(C,function(U){return U(A)});return{criteria:B,index:++K,value:A}});return a(Z,function(A,b){return u(A,b,$)})}m.exports=j},63135:m=>{function M(s,e){var n=s.length;for(s.sort(e);n--;)s[n]=s[n].value;return s}m.exports=M},17654:(m,M,s)=>{var e=s(85194);function n(o,i){if(o!==i){var a=o!==void 0,g=o===null,u=o===o,p=e(o),y=i!==void 0,j=i===null,D=i===i,C=e(i);if(!j&&!C&&!p&&o>i||p&&y&&D&&!j&&!C||g&&y&&D||!a&&D||!u)return 1;if(!g&&!p&&!C&&o<i||C&&a&&u&&!g&&!p||j&&a&&u||!y&&u||!D)return-1}return 0}m.exports=n},9998:(m,M,s)=>{var e=s(17654);function n(o,i,a){for(var g=-1,u=o.criteria,p=i.criteria,y=u.length,j=a.length;++g<y;){var D=e(u[g],p[g]);if(D){if(g>=j)return D;var C=a[g];return D*(C=="desc"?-1:1)}}return o.index-i.index}m.exports=n},52593:(m,M,s)=>{var e=s(47727);function n(o,i){return function(a,g){if(a==null)return a;if(!e(a))return o(a,g);for(var u=a.length,p=i?u:-1,y=Object(a);(i?p--:++p<u)&&g(y[p],p,y)!==!1;);return a}}m.exports=n},51425:m=>{function M(s,e,n){for(var o=n-1,i=s.length;++o<i;)if(s[o]===e)return o;return-1}m.exports=M},58422:(m,M,s)=>{var e=s(36393),n=s(90040),o=s(92403),i=s(26126);function a(g,u){var p=i(g)?e:o;return p(g,n(u,3))}m.exports=a},51006:(m,M,s)=>{var e=s(93367),n=s(16429),o=s(52431),i=s(65145),a=o(function(g,u){if(g==null)return[];var p=u.length;return p>1&&i(g,u[0],u[1])?u=[]:p>2&&i(u[0],u[1],u[2])&&(u=[u[0]]),n(g,e(u,1),[])});m.exports=a},34049:(m,M,s)=>{var e=s(20454);function n(o){var i=o==null?0:o.length;return i?e(o,1,i):[]}m.exports=n},41942:(m,M,s)=>{var e=s(20454),n=s(69740);function o(i,a,g){return i&&i.length?(a=g||a===void 0?1:n(a),e(i,0,a<0?0:a)):[]}m.exports=o},87366:(m,M,s)=>{var e=s(19975),n=s(52431),o=s(99662),i=n(function(a,g){return o(a)?e(a,g):[]});m.exports=i},20445:(m,M,s)=>{"use strict";s.r(M),s.d(M,{default:()=>ds});var e=s(74081),n=s(1180),o=s(51447),i=s(45857),a=s(27279),g=s(93415),u=s(10701),p=s(21395),y=s(22572),j=s(23298),D=s(74577),C=s(10989),$=s(45322),K=s(24920),Z=s(34642),A=s(73354),b=s(27875),w=s(48102),B=s(74758),U=s(12881),H=s(39708),je=s(68412),De=s(86967),ne=s(93153),W=s(50086),Ce=s(4987),Oe=s(51926),ye=s(27997),Re=s(37472),Ae=s(70774),ve=s(38101),Te=s(35318),ie=s(59082),Le=s(76827),be=s(26784),Be=s(78665),Ie=s(36938),re=s(71563),S=s(61020),F=s(40464),T=s(70627),Ue=s(51943),ae=s(51006),z=s(98934),Q=s(72450),oe=s(61815),Y=s(10124),Se=s(87366),We=s(58422),Ke=s(34049),le=s(43433),Ze=s(41942),q=s(47853);const de=(0,a.createContext)({}),ce=({children:t,value:r})=>(0,e.jsx)(de.Provider,{value:r,children:t}),ee=()=>(0,a.useContext)(de);ce.propTypes={children:T.node.isRequired,value:T.object.isRequired};function ke(t){switch(t){case"application":return"Application";case"plugin::content-manager":return"Content manager";case"plugin::content-type-builder":return"Content types builder";case"plugin::documentation":return"Documentation";case"plugin::email":return"Email";case"plugin::i18n":return"i18n";case"plugin::upload":return"Upload";case"plugin::users-permissions":return"Users-permissions";default:return Ue(t.replace("api::","").replace("plugin::",""))}}const Ne=(t,r)=>{const l=Object.keys(r).sort().map(d=>({name:d,isOpen:!1}));return{...t,collapses:l}},ue=(0,Q.css)`
  background: ${t=>t.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,$e=(0,Q.default)(g.x)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${t=>t.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${t=>t.isActive&&ue}
  &:hover {
    ${ue}
  }
`,Fe=Q.default.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:t})=>t.colors.neutral150};
`,ge=({subCategory:t})=>{const{formatMessage:r}=(0,S.Z)(),{onChange:l,onChangeSelectAll:d,onSelectedAction:x,selectedAction:c,modifiedData:f}=ee(),P=(0,a.useMemo)(()=>z(f,t.name,{}),[f,t]),E=(0,a.useMemo)(()=>Object.values(P).every(h=>h.enabled===!0),[P]),_=(0,a.useMemo)(()=>Object.values(P).some(h=>h.enabled===!0)&&!E,[P,E]),O=(0,a.useCallback)(({target:{name:h}})=>{d({target:{name:h,value:!E}})},[E,d]),R=(0,a.useCallback)(h=>c===h,[c]);return(0,e.jsxs)(g.x,{children:[(0,e.jsxs)(u.k,{justifyContent:"space-between",alignItems:"center",children:[(0,e.jsx)(g.x,{paddingRight:4,children:(0,e.jsx)(p.Z,{variant:"sigma",textColor:"neutral600",children:t.label})}),(0,e.jsx)(Fe,{}),(0,e.jsx)(g.x,{paddingLeft:4,children:(0,e.jsx)(y.X,{name:t.name,value:E,onValueChange:h=>O({target:{name:t.name,value:h}}),indeterminate:_,children:r({id:"app.utils.select-all",defaultMessage:"Select all"})})})]}),(0,e.jsx)(u.k,{paddingTop:6,paddingBottom:6,children:(0,e.jsx)(j.r,{gap:2,style:{flex:1},children:t.actions.map(h=>{const v=`${h.name}.enabled`;return(0,e.jsx)(D.P,{col:6,children:(0,e.jsxs)($e,{isActive:R(h.name),padding:2,hasRadius:!0,children:[(0,e.jsx)(y.X,{value:z(f,v,!1),name:v,onValueChange:I=>l({target:{name:v,value:I}}),children:h.label}),(0,e.jsxs)("button",{type:"button",onClick:()=>x(h.name),style:{display:"inline-flex",alignItems:"center"},children:[(0,e.jsx)(C.T,{as:"span",children:r({id:"app.utils.show-bound-route",defaultMessage:"Show bound route for {route}"},{route:h.name})}),(0,e.jsx)(Te.Z,{})]})]})},h.name)})})})]})};ge.propTypes={subCategory:T.object.isRequired};const he=({name:t,permissions:r})=>{const l=(0,a.useMemo)(()=>ae(Object.values(r.controllers).reduce((d,x,c)=>{const f=`${t}.controllers.${Object.keys(r.controllers)[c]}`,P=ae(Object.keys(x).reduce((E,_)=>[...E,{...x[_],label:_,name:`${f}.${_}`}],[]),"label");return[...d,{actions:P,label:Object.keys(r.controllers)[c],name:f}]},[]),"label"),[t,r]);return(0,e.jsx)(g.x,{padding:6,children:l.map(d=>(0,e.jsx)(ge,{subCategory:d},d.name))})};he.propTypes={name:T.string.isRequired,permissions:T.object.isRequired};const Ge={collapses:[]},Ve=(t,r)=>(0,oe.ZP)(t,l=>{switch(r.type){case"TOGGLE_COLLAPSE":{l.collapses=t.collapses.map((d,x)=>x===r.index?{...d,isOpen:!d.isOpen}:{...d,isOpen:!1});break}default:return l}}),we=()=>{const{modifiedData:t}=ee(),{formatMessage:r}=(0,S.Z)(),[{collapses:l},d]=(0,a.useReducer)(Ve,Ge,c=>Ne(c,t)),x=c=>d({type:"TOGGLE_COLLAPSE",index:c});return(0,e.jsx)(u.k,{direction:"column",alignItems:"stretch",gap:1,children:l.map((c,f)=>(0,e.jsxs)($.U,{expanded:c.isOpen,onToggle:()=>x(f),variant:f%2===0?"secondary":void 0,children:[(0,e.jsx)(K.B,{title:ke(c.name),description:r({id:"users-permissions.Plugin.permissions.plugins.description",defaultMessage:"Define all allowed actions for the {name} plugin."},{name:c.name}),variant:f%2?"primary":"secondary"}),(0,e.jsx)(Z.v,{children:(0,e.jsx)(he,{permissions:t[c.name],name:c.name})})]},c.name))})},He=t=>{switch(t){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},Qe=(0,Q.default)(g.x)`
  margin: -1px;
  border-radius: ${({theme:t})=>t.spaces[1]} 0 0 ${({theme:t})=>t.spaces[1]};
`;function se({route:t}){const{formatMessage:r}=(0,S.Z)(),{method:l,handler:d,path:x}=t,c=x?Ke(x.split("/")):[],[f="",P=""]=d?d.split("."):[],E=He(t.method);return(0,e.jsxs)(u.k,{direction:"column",alignItems:"stretch",gap:2,children:[(0,e.jsxs)(p.Z,{variant:"delta",as:"h3",children:[r({id:"users-permissions.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",(0,e.jsx)("span",{children:f}),(0,e.jsxs)(p.Z,{variant:"delta",textColor:"primary600",children:[".",P]})]}),(0,e.jsxs)(u.k,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0,children:[(0,e.jsx)(Qe,{background:E.background,borderColor:E.border,padding:2,children:(0,e.jsx)(p.Z,{fontWeight:"bold",textColor:E.text,children:l})}),(0,e.jsx)(g.x,{paddingLeft:2,paddingRight:2,children:We(c,_=>(0,e.jsxs)(p.Z,{textColor:_.includes(":")?"neutral600":"neutral900",children:["/",_]},_))})]})]})}se.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},se.propTypes={route:T.shape({handler:T.string,method:T.string,path:T.string})};const ze=()=>{const{formatMessage:t}=(0,S.Z)(),{selectedAction:r,routes:l}=ee(),d=Se(r.split("."),"controllers"),x=z(l,d[0]),c=d.slice(1).join("."),f=Y(x)?[]:x.filter(P=>P.handler.endsWith(c));return(0,e.jsx)(D.P,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"},children:r?(0,e.jsx)(u.k,{direction:"column",alignItems:"stretch",gap:2,children:f.map((P,E)=>(0,e.jsx)(se,{route:P},E))}):(0,e.jsxs)(u.k,{direction:"column",alignItems:"stretch",gap:2,children:[(0,e.jsx)(p.Z,{variant:"delta",as:"h3",children:t({id:"users-permissions.Policies.header.title",defaultMessage:"Advanced settings"})}),(0,e.jsx)(p.Z,{as:"p",textColor:"neutral600",children:t({id:"users-permissions.Policies.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"})})]})})},Je=(t,r,l)=>({...t,initialData:r,modifiedData:r,routes:l}),Xe={initialData:{},modifiedData:{},routes:{},selectedAction:"",policies:[]},Ye=(t,r)=>(0,oe.ZP)(t,l=>{switch(r.type){case"ON_CHANGE":{const d=r.keys.length,x=r.keys[d-1]==="enabled";if(r.value&&x){const c=Ze(r.keys,d-1).join(".");l.selectedAction=c}le(l,["modifiedData",...r.keys],r.value);break}case"ON_CHANGE_SELECT_ALL":{const d=["modifiedData",...r.keys],x=z(t,d,{}),c=Object.keys(x).reduce((f,P)=>(f[P]={...x[P],enabled:r.value},f),{});le(l,d,c);break}case"ON_RESET":{l.modifiedData=t.initialData;break}case"ON_SUBMIT_SUCCEEDED":{l.initialData=t.modifiedData;break}case"SELECT_ACTION":{const{actionToSelect:d}=r;l.selectedAction=d===t.selectedAction?"":d;break}default:return l}}),pe=(0,a.forwardRef)(({permissions:t,routes:r},l)=>{const{formatMessage:d}=(0,S.Z)(),[x,c]=(0,a.useReducer)(Ye,Xe,O=>Je(O,t,r));(0,a.useImperativeHandle)(l,()=>({getPermissions(){return{permissions:x.modifiedData}},resetForm(){c({type:"ON_RESET"})},setFormAfterSubmit(){c({type:"ON_SUBMIT_SUCCEEDED"})}}));const _={...x,onChange:({target:{name:O,value:R}})=>c({type:"ON_CHANGE",keys:O.split("."),value:R==="empty__string_value"?"":R}),onChangeSelectAll:({target:{name:O,value:R}})=>c({type:"ON_CHANGE_SELECT_ALL",keys:O.split("."),value:R}),onSelectedAction:O=>c({type:"SELECT_ACTION",actionToSelect:O})};return(0,e.jsx)(ce,{value:_,children:(0,e.jsxs)(j.r,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0",children:[(0,e.jsx)(D.P,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,e.jsxs)(u.k,{direction:"column",alignItems:"stretch",gap:6,children:[(0,e.jsxs)(u.k,{direction:"column",alignItems:"stretch",gap:2,children:[(0,e.jsx)(p.Z,{variant:"delta",as:"h2",children:d({id:(0,i.g)("Plugins.header.title"),defaultMessage:"Permissions"})}),(0,e.jsx)(p.Z,{as:"p",textColor:"neutral600",children:d({id:(0,i.g)("Plugins.header.description"),defaultMessage:"Only actions bound by a route are listed below."})})]}),(0,e.jsx)(we,{})]})}),(0,e.jsx)(ze,{})]})})});pe.propTypes={permissions:T.object.isRequired,routes:T.object.isRequired};const me=(0,a.memo)(pe),xe=q.Ry().shape({name:q.Z_().required(n.translatedErrors.required),description:q.Z_().required(n.translatedErrors.required)}),qe=t=>Object.keys(t).reduce((r,l)=>{const d=t[l].controllers,x=Object.keys(d).reduce((c,f)=>(Y(d[f])||(c[f]=d[f]),c),{});return Y(x)||(r[l]={controllers:x}),r},{}),fe=()=>{const t=(0,n.useNotification)(),{get:r}=(0,n.useFetchClient)(),{formatAPIError:l}=(0,n.useAPIErrorHandler)(i.g),[{data:d,isLoading:x,error:c,refetch:f},{data:P,isLoading:E,error:_,refetch:O}]=(0,F.useQueries)([{queryKey:["users-permissions","permissions"],async queryFn(){const{data:{permissions:v}}=await r("/users-permissions/permissions");return v}},{queryKey:["users-permissions","routes"],async queryFn(){const{data:{routes:v}}=await r("/users-permissions/routes");return v}}]),R=async()=>{await Promise.all([f(),O()])};(0,a.useEffect)(()=>{c&&t({type:"warning",message:l(c)})},[t,c,l]),(0,a.useEffect)(()=>{_&&t({type:"warning",message:l(_)})},[t,_,l]);const h=x||E;return{permissions:d?qe(d):{},routes:P??{},getData:R,isLoading:h}},es=()=>{const{formatMessage:t}=(0,S.Z)(),r=(0,n.useNotification)(),{goBack:l}=(0,o.k6)(),{lockApp:d,unlockApp:x}=(0,n.useOverlayBlocker)(),{isLoading:c,permissions:f,routes:P}=fe(),{trackUsage:E}=(0,n.useTracking)(),_=a.useRef(),{post:O}=(0,n.useFetchClient)(),R=(0,F.useMutation)(v=>O("/users-permissions/roles",v),{onError(){r({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})},onSuccess(){E("didCreateRole"),r({type:"success",message:{id:(0,i.g)("Settings.roles.created"),defaultMessage:"Role created"}}),l()}}),h=async v=>{d();const I=_.current.getPermissions();await R.mutate({...v,...I,users:[]}),x()};return(0,e.jsxs)(A.o,{children:[(0,e.jsx)(n.SettingsPageTitle,{name:"Roles"}),(0,e.jsx)(re.J9,{enableReinitialize:!0,initialValues:{name:"",description:""},onSubmit:h,validationSchema:xe,children:({handleSubmit:v,values:I,handleChange:G,errors:L})=>(0,e.jsxs)(n.Form,{noValidate:!0,onSubmit:v,children:[(0,e.jsx)(b.T,{primaryAction:!c&&(0,e.jsx)(w.z,{type:"submit",loading:R.isLoading,startIcon:(0,e.jsx)(ie.Z,{}),children:t({id:"global.save",defaultMessage:"Save"})}),title:t({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:t({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"})}),(0,e.jsx)(B.D,{children:(0,e.jsxs)(u.k,{background:"neutral0",direction:"column",alignItems:"stretch",gap:7,hasRadius:!0,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,shadow:"filterShadow",children:[(0,e.jsxs)(u.k,{direction:"column",alignItems:"stretch",children:[(0,e.jsx)(p.Z,{variant:"delta",as:"h2",children:t({id:(0,i.g)("EditPage.form.roles"),defaultMessage:"Role details"})}),(0,e.jsxs)(j.r,{gap:4,children:[(0,e.jsx)(D.P,{col:6,children:(0,e.jsx)(U.o,{name:"name",value:I.name||"",onChange:G,label:t({id:"global.name",defaultMessage:"Name"}),error:L?.name?t({id:L.name,defaultMessage:"Name is required"}):!1,required:!0})}),(0,e.jsx)(D.P,{col:6,children:(0,e.jsx)(H.g,{id:"description",value:I.description||"",onChange:G,label:t({id:"global.description",defaultMessage:"Description"}),error:L?.description?t({id:L.description,defaultMessage:"Description is required"}):!1,required:!0})})]})]}),!c&&(0,e.jsx)(me,{ref:_,permissions:f,routes:P})]})})]})})]})},ss=()=>(0,e.jsx)(n.CheckPagePermissions,{permissions:i.P.createRole,children:(0,e.jsx)(es,{})}),ts=()=>{const{formatMessage:t}=(0,S.Z)(),r=(0,n.useNotification)(),{lockApp:l,unlockApp:d}=(0,n.useOverlayBlocker)(),{params:{id:x}}=(0,o.$B)("/settings/users-permissions/roles/:id"),{get:c}=(0,n.useFetchClient)(),{isLoading:f,routes:P}=fe(),{data:E,isLoading:_,refetch:O}=(0,F.useQuery)(["users-permissions","role",x],async()=>{const{data:{role:L}}=await c(`/users-permissions/roles/${x}`);return L}),R=a.useRef(),{put:h}=(0,n.useFetchClient)(),{formatAPIError:v}=(0,n.useAPIErrorHandler)(),I=(0,F.useMutation)(L=>h(`/users-permissions/roles/${x}`,L),{onError(L){r({type:"warning",message:v(L)})},async onSuccess(){r({type:"success",message:{id:(0,i.g)("Settings.roles.created"),defaultMessage:"Role edited"}}),await O()}}),G=async L=>{l();const k=R.current.getPermissions();await I.mutate({...L,...k,users:[]}),d()};return _?(0,e.jsx)(n.LoadingIndicatorPage,{}):(0,e.jsxs)(A.o,{children:[(0,e.jsx)(n.SettingsPageTitle,{name:"Roles"}),(0,e.jsx)(re.J9,{enableReinitialize:!0,initialValues:{name:E.name,description:E.description},onSubmit:G,validationSchema:xe,children:({handleSubmit:L,values:k,handleChange:J,errors:V})=>(0,e.jsxs)(n.Form,{noValidate:!0,onSubmit:L,children:[(0,e.jsx)(b.T,{primaryAction:!f&&(0,e.jsx)(w.z,{disabled:E.code==="strapi-super-admin",type:"submit",loading:I.isLoading,startIcon:(0,e.jsx)(ie.Z,{}),children:t({id:"global.save",defaultMessage:"Save"})}),title:E.name,subtitle:E.description,navigationAction:(0,e.jsx)(n.Link,{startIcon:(0,e.jsx)(Le.Z,{}),to:"/settings/users-permissions/roles",children:t({id:"global.back",defaultMessage:"Back"})})}),(0,e.jsx)(B.D,{children:(0,e.jsxs)(u.k,{background:"neutral0",direction:"column",alignItems:"stretch",gap:7,hasRadius:!0,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,shadow:"filterShadow",children:[(0,e.jsxs)(u.k,{direction:"column",alignItems:"stretch",gap:4,children:[(0,e.jsx)(p.Z,{variant:"delta",as:"h2",children:t({id:(0,i.g)("EditPage.form.roles"),defaultMessage:"Role details"})}),(0,e.jsxs)(j.r,{gap:4,children:[(0,e.jsx)(D.P,{col:6,children:(0,e.jsx)(U.o,{name:"name",value:k.name||"",onChange:J,label:t({id:"global.name",defaultMessage:"Name"}),error:V?.name?t({id:V.name,defaultMessage:"Name is required"}):!1,required:!0})}),(0,e.jsx)(D.P,{col:6,children:(0,e.jsx)(H.g,{id:"description",value:k.description||"",onChange:J,label:t({id:"global.description",defaultMessage:"Description"}),error:V?.description?t({id:V.description,defaultMessage:"Description is required"}):!1,required:!0})})]})]}),!f&&(0,e.jsx)(me,{ref:R,permissions:E.permissions,routes:P})]})})]})})]})},ns=()=>(0,e.jsx)(n.CheckPagePermissions,{permissions:i.P.updateRole,children:(0,e.jsx)(ts,{})}),is=(0,Q.default)(je.r)`
  align-items: center;
  height: ${(0,n.pxToRem)(32)};
  display: flex;
  justify-content: center;
  padding: ${({theme:t})=>`${t.spaces[2]}}`};
  width: ${(0,n.pxToRem)(32)};

  svg {
    height: ${(0,n.pxToRem)(12)};
    width: ${(0,n.pxToRem)(12)};

    path {
      fill: ${({theme:t})=>t.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:t})=>t.colors.neutral800};
      }
    }
  }
`,te=({sortedRoles:t,canDelete:r,permissions:l,setRoleToDelete:d,onDelete:x})=>{const{formatMessage:c}=(0,S.Z)(),{push:f}=(0,o.k6)(),[P,E]=x,_=h=>r&&!["public","authenticated"].includes(h.type),O=h=>{d(h),E(!P)},R=h=>{f(`/settings/users-permissions/roles/${h}`)};return(0,e.jsx)(De.p,{children:t?.map(h=>(0,e.jsxs)(ne.Tr,{...(0,n.onRowClick)({fn:()=>R(h.id)}),children:[(0,e.jsx)(W.Td,{width:"20%",children:(0,e.jsx)(p.Z,{children:h.name})}),(0,e.jsx)(W.Td,{width:"50%",children:(0,e.jsx)(p.Z,{children:h.description})}),(0,e.jsx)(W.Td,{width:"30%",children:(0,e.jsx)(p.Z,{children:c({id:"Roles.RoleRow.user-count",defaultMessage:"{number, plural, =0 {# user} one {# user} other {# users}}"},{number:h.nb_users})})}),(0,e.jsx)(W.Td,{children:(0,e.jsxs)(u.k,{justifyContent:"end",...n.stopPropagation,children:[(0,e.jsx)(n.CheckPermissions,{permissions:l.updateRole,children:(0,e.jsx)(is,{to:`/settings/users-permissions/roles/${h.id}`,"aria-label":c({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:`${h.name}`}),children:(0,e.jsx)(be.Z,{})})}),_(h)&&(0,e.jsx)(n.CheckPermissions,{permissions:l.deleteRole,children:(0,e.jsx)(Ce.h,{onClick:()=>O(h.id),noBorder:!0,icon:(0,e.jsx)(Be.Z,{}),label:c({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${h.name}`})})})]})})]},h.name))})};te.defaultProps={canDelete:!1},te.propTypes={onDelete:T.array.isRequired,permissions:T.object.isRequired,setRoleToDelete:T.func.isRequired,sortedRoles:T.array.isRequired,canDelete:T.bool};const rs=async(t,r)=>{try{const{get:l}=(0,n.getFetchClient)(),{data:d}=await l("/users-permissions/roles");return r("The roles have loaded successfully"),d}catch(l){throw t({type:"warning",message:{id:"notification.error"}}),new Error(l)}},as=async(t,r)=>{try{const{del:l}=(0,n.getFetchClient)();await l(`/users-permissions/roles/${t}`)}catch{r({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}},os=()=>{const{trackUsage:t}=(0,n.useTracking)(),{formatMessage:r,locale:l}=(0,S.Z)(),d=(0,n.useNotification)(),{notifyStatus:x}=(0,Oe.G)(),[{query:c}]=(0,n.useQueryParams)(),f=c?._q||"",[P,E]=(0,a.useState)(!1),[_,O]=(0,a.useState)(!1),[R,h]=(0,a.useState)();(0,n.useFocusWhenNavigate)();const{isLoading:v,allowedActions:{canRead:I,canDelete:G}}=(0,n.useRBAC)({create:i.P.createRole,read:i.P.readRoles,update:i.P.updateRole,delete:i.P.deleteRole}),{isLoading:L,data:{roles:k},isFetching:J,refetch:V}=(0,F.useQuery)("get-roles",()=>rs(d,x),{initialData:{},enabled:I}),{includes:Ee}=(0,n.useFilter)(l,{sensitivity:"base"}),Pe=(0,n.useCollator)(l,{sensitivity:"base"}),Me=L||J,cs=()=>{E(!P)},us={roles:{id:(0,i.g)("Roles.empty"),defaultMessage:"You don't have any roles yet."},search:{id:(0,i.g)("Roles.empty.search"),defaultMessage:"No roles match the search."}},gs=r({id:"global.roles",defaultMessage:"Roles"}),hs=(0,F.useMutation)(N=>as(N,d),{async onSuccess(){await V()}}),ps=async()=>{O(!0),await hs.mutateAsync(R),E(!P),O(!1)},X=(k||[]).filter(N=>Ee(N.name,f)||Ee(N.description,f)).sort((N,_e)=>Pe.compare(N.name,_e.name)||Pe.compare(N.description,_e.description)),ms=f&&!X.length?"search":"roles",xs=4,fs=(k?.length||0)+1;return(0,e.jsxs)(ye.A,{children:[(0,e.jsx)(n.SettingsPageTitle,{name:gs}),(0,e.jsxs)(A.o,{"aria-busy":Me,children:[(0,e.jsx)(b.T,{title:r({id:"global.roles",defaultMessage:"Roles"}),subtitle:r({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),primaryAction:(0,e.jsx)(n.CheckPermissions,{permissions:i.P.createRole,children:(0,e.jsx)(n.LinkButton,{to:"/settings/users-permissions/roles/new",onClick:()=>t("willCreateRole"),startIcon:(0,e.jsx)(Ie.Z,{}),size:"S",children:r({id:(0,i.g)("List.button.roles"),defaultMessage:"Add new role"})})})}),(0,e.jsx)(Re.Z,{startActions:(0,e.jsx)(n.SearchURLQuery,{label:r({id:"app.component.search.label",defaultMessage:"Search"})})}),(0,e.jsxs)(B.D,{children:[!I&&(0,e.jsx)(n.NoPermissions,{}),(Me||v)&&(0,e.jsx)(n.LoadingIndicatorPage,{}),I&&X&&X?.length?(0,e.jsxs)(Ae.i,{colCount:xs,rowCount:fs,children:[(0,e.jsx)(ve.h,{children:(0,e.jsxs)(ne.Tr,{children:[(0,e.jsx)(W.Th,{children:(0,e.jsx)(p.Z,{variant:"sigma",textColor:"neutral600",children:r({id:"global.name",defaultMessage:"Name"})})}),(0,e.jsx)(W.Th,{children:(0,e.jsx)(p.Z,{variant:"sigma",textColor:"neutral600",children:r({id:"global.description",defaultMessage:"Description"})})}),(0,e.jsx)(W.Th,{children:(0,e.jsx)(p.Z,{variant:"sigma",textColor:"neutral600",children:r({id:"global.users",defaultMessage:"Users"})})}),(0,e.jsx)(W.Th,{children:(0,e.jsx)(C.T,{children:r({id:"global.actions",defaultMessage:"Actions"})})})]})}),(0,e.jsx)(te,{sortedRoles:X,canDelete:G,permissions:i.P,setRoleToDelete:h,onDelete:[P,E]})]}):(0,e.jsx)(n.EmptyStateLayout,{content:us[ms]})]}),(0,e.jsx)(n.ConfirmDialog,{isConfirmButtonLoading:_,onConfirm:ps,onToggleDialog:cs,isOpen:P})]})]})},ls=()=>(0,e.jsx)(n.CheckPagePermissions,{permissions:i.P.accessRoles,children:(0,e.jsx)(os,{})}),ds=()=>(0,e.jsx)(n.CheckPagePermissions,{permissions:i.P.accessRoles,children:(0,e.jsxs)(o.rs,{children:[(0,e.jsx)(o.AW,{path:"/settings/users-permissions/roles/new",component:ss,exact:!0}),(0,e.jsx)(o.AW,{path:"/settings/users-permissions/roles/:id",component:ns,exact:!0}),(0,e.jsx)(o.AW,{path:"/settings/users-permissions/roles",component:ls,exact:!0}),(0,e.jsx)(o.AW,{path:"",component:n.AnErrorOccurred})]})})}}]);
