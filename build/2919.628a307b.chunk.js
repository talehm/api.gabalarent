"use strict";(self.webpackChunkstrapi=self.webpackChunkstrapi||[]).push([[2919],{92919:(re,I,s)=>{s.r(I),s.d(I,{U:()=>Pe,i:()=>Re});var e=s(74081),t=s(1180),D=s(49402),P=s(44328),f=s(27279),y=s(48102),o=s(86967),h=s(93153),C=s(50086),i=s(73411),u=s(21395),_=s(10701),x=s(4987),l=s(93415),E=s(5938),G=s(6918),oe=s(15244),te=s(23298),W=s(74577),j=s(35250),g=s(73354),K=s(27875),J=s(37472),X=s(74758),k=s(29206),M=s(61020),z=s(40464),ae=s(51447),le=s(11266),b=s(92401),de=s(79211),A=s(16543),fe=s(26784),he=s(78665),r=s(70627),Oe=s(89486),De=s(82298),ye=s(71563),_e=s(83595),w=s(47853);const Ee=({onClick:a})=>{const{formatMessage:d}=(0,M.Z)();return(0,e.jsx)(y.z,{onClick:a,startIcon:(0,e.jsx)(A.Z,{}),size:"S",children:d({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"})})};Ee.propTypes={onClick:r.func.isRequired};const ce=({canDelete:a,headers:d,entriesToDelete:T,onClickDelete:q,onSelectRow:N,withMainAction:F,withBulkActions:B,rows:v})=>{const{push:p,location:{pathname:Q}}=(0,ae.k6)(),{formatMessage:O}=(0,M.Z)();return(0,e.jsx)(o.p,{children:v.map(n=>{const Z=T.findIndex(R=>R===n.id)!==-1;return(0,e.jsxs)(h.Tr,{...(0,t.onRowClick)({fn:()=>p(`${Q}/${n.id}`),condition:B}),children:[F&&(0,e.jsx)(C.Td,{...t.stopPropagation,children:(0,e.jsx)(i.C,{"aria-label":O({id:"app.component.table.select.one-entry",defaultMessage:"Select {target}"},{target:(0,P.g)(n.firstname,n.lastname)}),checked:Z,onChange:()=>{N({name:n.id,value:!Z})}})}),d.map(({key:R,cellFormatter:$,name:S,...V})=>(0,e.jsx)(C.Td,{children:typeof $=="function"?$(n,{key:R,name:S,formatMessage:O,...V}):(0,e.jsx)(u.Z,{textColor:"neutral800",children:n[S]||"-"})},R)),B&&(0,e.jsx)(C.Td,{children:(0,e.jsxs)(_.k,{justifyContent:"end",children:[(0,e.jsx)(x.h,{onClick:()=>p(`${Q}/${n.id}`),label:O({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:(0,P.g)(n.firstname,n.lastname)}),noBorder:!0,icon:(0,e.jsx)(fe.Z,{})}),a&&(0,e.jsx)(l.x,{paddingLeft:1,...t.stopPropagation,children:(0,e.jsx)(x.h,{onClick:()=>q(n.id),label:O({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:(0,P.g)(n.firstname,n.lastname)}),noBorder:!0,icon:(0,e.jsx)(he.Z,{})})})]})})]},n.id)})})};ce.defaultProps={canDelete:!1,entriesToDelete:[],onClickDelete(){},onSelectRow(){},rows:[],withBulkActions:!1,withMainAction:!1},ce.propTypes={canDelete:r.bool,entriesToDelete:r.array,headers:r.array.isRequired,onClickDelete:r.func,onSelectRow:r.func,rows:r.array,withBulkActions:r.bool,withMainAction:r.bool};const ge={firstname:"",lastname:"",email:"",roles:[]},Ce=[],xe=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0}]],Ae=w.Ry().shape({firstname:w.Z_().trim().required(t.translatedErrors.required),lastname:w.Z_(),email:w.Z_().email(t.translatedErrors.email).required(t.translatedErrors.required),roles:w.IX().min(1,t.translatedErrors.required).required(t.translatedErrors.required)}),Te={create:{buttonSubmitLabel:{id:"app.containers.Users.ModalForm.footer.button-success",defaultMessage:"Invite user"},isDisabled:!1,next:"magic-link"},"magic-link":{buttonSubmitLabel:{id:"global.finish",defaultMessage:"Finish"},isDisabled:!0,next:null}},Me=({onSuccess:a,onToggle:d})=>{const[T,q]=(0,f.useState)("create"),[N,F]=(0,f.useState)(!1),[B,v]=(0,f.useState)(null),{formatMessage:p}=(0,M.Z)(),Q=(0,t.useNotification)(),{lockApp:O,unlockApp:n}=(0,t.useOverlayBlocker)(),{post:Z}=(0,t.useFetchClient)(),R=(0,b.p)(Ce,async()=>(await s.e(9385).then(s.bind(s,19385))).ROLE_LAYOUT,{combine(m,U){return[...m,U]},defaultValue:[]}),$=(0,b.p)(ge,async()=>(await s.e(9385).then(s.bind(s,19385))).FORM_INITIAL_VALUES,{combine(m,U){return{...m,...U}},defaultValue:ge}),S=(0,b.p)(_e.M,async()=>(await s.e(1254).then(s.bind(s,91254))).MagicLinkEE),V=(0,z.useMutation)(m=>Z("/admin/users",m),{async onSuccess({data:m}){v(m.data.registrationToken),await a(),ie(),F(!1)},onError(m){throw F(!1),Q({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),m},onSettled(){n()}}),ee=p({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"}),ne=async(m,{setErrors:U})=>{O(),F(!0);try{await V.mutateAsync(m)}catch(H){n(),H?.response?.data?.error.message==="Email already taken"&&U({email:H.response.data.error.message})}},ie=()=>{c?q(c):d()},{buttonSubmitLabel:se,isDisabled:Y,next:c}=Te[T],Ue=T==="create"?(0,e.jsx)(y.z,{type:"submit",loading:N,children:p(se)}):(0,e.jsx)(y.z,{type:"button",loading:N,onClick:d,children:p(se)});return S?(0,e.jsxs)(E.P,{onClose:d,labelledBy:"title",children:[(0,e.jsx)(G.x,{children:(0,e.jsx)(Oe.O,{label:ee,children:(0,e.jsx)(De.$,{isCurrent:!0,children:ee})})}),(0,e.jsx)(ye.J9,{enableReinitialize:!0,initialValues:$,onSubmit:ne,validationSchema:Ae,validateOnChange:!1,children:({errors:m,handleChange:U,values:H})=>(0,e.jsxs)(t.Form,{children:[(0,e.jsx)(oe.f,{children:(0,e.jsxs)(_.k,{direction:"column",alignItems:"stretch",gap:6,children:[T!=="create"&&(0,e.jsx)(S,{registrationToken:B}),(0,e.jsxs)(l.x,{children:[(0,e.jsx)(u.Z,{variant:"beta",as:"h2",children:p({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"User details"})}),(0,e.jsx)(l.x,{paddingTop:4,children:(0,e.jsx)(_.k,{direction:"column",alignItems:"stretch",gap:1,children:(0,e.jsx)(te.r,{gap:5,children:xe.map(ue=>ue.map(L=>(0,e.jsx)(W.P,{...L.size,children:(0,e.jsx)(t.GenericInput,{...L,disabled:Y,error:m[L.name],onChange:U,value:H[L.name]})},L.name)))})})})]}),(0,e.jsxs)(l.x,{children:[(0,e.jsx)(u.Z,{variant:"beta",as:"h2",children:p({id:"global.roles",defaultMessage:"User's role"})}),(0,e.jsx)(l.x,{paddingTop:4,children:(0,e.jsxs)(te.r,{gap:5,children:[(0,e.jsx)(W.P,{col:6,xs:12,children:(0,e.jsx)(_e.S,{disabled:Y,error:m.roles,onChange:U,value:H.roles})}),R.map(ue=>ue.map(L=>(0,e.jsx)(W.P,{...L.size,children:(0,e.jsx)(t.GenericInput,{...L,disabled:Y,onChange:U,value:H[L.name]})},L.name)))]})})]})]})}),(0,e.jsx)(j.m,{startActions:(0,e.jsx)(y.z,{variant:"tertiary",onClick:d,type:"button",children:p({id:"app.components.Button.cancel",defaultMessage:"Cancel"})}),endActions:Ue})]})})]}):null};Me.propTypes={onToggle:r.func.isRequired,onSuccess:r.func.isRequired};const me=({pagination:a})=>(0,e.jsx)(l.x,{paddingTop:4,children:(0,e.jsxs)(_.k,{alignItems:"flex-end",justifyContent:"space-between",children:[(0,e.jsx)(t.PageSizeURLQuery,{}),(0,e.jsx)(t.PaginationURLQuery,{pagination:a})]})});me.defaultProps={pagination:{pageCount:0,pageSize:10,total:0}},me.propTypes={pagination:r.shape({page:r.number,pageCount:r.number,pageSize:r.number,total:r.number})};const Le=[{name:"firstname",metadatas:{label:"Firstname"},fieldSchema:{type:"string"}},{name:"lastname",metadatas:{label:"Lastname"},fieldSchema:{type:"string"}},{name:"email",metadatas:{label:"Email"},fieldSchema:{type:"email"}},{name:"username",metadatas:{label:"Username"},fieldSchema:{type:"string"}},{name:"isActive",metadatas:{label:"Active user"},fieldSchema:{type:"boolean"}}],je=[{name:"firstname",key:"firstname",metadatas:{label:{id:"Settings.permissions.users.firstname",defaultMessage:"Firstname"},sortable:!0}},{name:"lastname",key:"lastname",metadatas:{label:{id:"Settings.permissions.users.lastname",defaultMessage:"Lastname"},sortable:!0}},{key:"email",name:"email",metadatas:{label:{id:"Settings.permissions.users.email",defaultMessage:"Email"},sortable:!0}},{key:"roles",name:"roles",metadatas:{label:{id:"Settings.permissions.users.roles",defaultMessage:"Roles"},sortable:!1},cellFormatter({roles:a},{formatMessage:d}){return(0,e.jsx)(u.Z,{textColor:"neutral800",children:a.map(T=>d({id:`Settings.permissions.users.${T.code}`,defaultMessage:T.name})).join(`,
`)})}},{key:"username",name:"username",metadatas:{label:{id:"Settings.permissions.users.username",defaultMessage:"Username"},sortable:!0}},{key:"isActive",name:"isActive",metadatas:{label:{id:"Settings.permissions.users.user-status",defaultMessage:"User status"},sortable:!1},cellFormatter({isActive:a},{formatMessage:d}){return(0,e.jsxs)(_.k,{children:[(0,e.jsx)(t.Status,{isActive:a,variant:a?"success":"danger"}),(0,e.jsx)(u.Z,{textColor:"neutral800",children:d({id:a?"Settings.permissions.users.active":"Settings.permissions.users.inactive",defaultMessage:a?"Active":"Inactive"})})]})}}],pe=["ee","license-limit-info"],Pe=()=>{const{post:a}=(0,t.useFetchClient)(),{formatAPIError:d}=(0,t.useAPIErrorHandler)(),[T,q]=(0,f.useState)(!1),N=(0,D.useSelector)(P.s),{allowedActions:{canCreate:F,canDelete:B,canRead:v}}=(0,t.useRBAC)(N.settings.users),p=(0,z.useQueryClient)(),Q=(0,t.useNotification)(),{formatMessage:O}=(0,M.Z)(),{search:n}=(0,ae.TH)();(0,t.useFocusWhenNavigate)();const{users:Z,pagination:R,isError:$,isLoading:S,refetch:V}=(0,le.u)(k.parse(n,{ignoreQueryPrefix:!0}),{cacheTime:0,enabled:v}),ee=(0,b.p)(Ee,async()=>(await s.e(8384).then(s.bind(s,98384))).CreateActionEE),ne=je.map(c=>({...c,metadatas:{...c.metadatas,label:O(c.metadatas.label)}})),ie=O({id:"global.users",defaultMessage:"Users"}),se=()=>{q(c=>!c)},Y=(0,z.useMutation)(async c=>{await a("/admin/users/batch-delete",{ids:c})},{async onSuccess(){await V(),await p.refetchQueries(pe)},onError(c){Q({type:"warning",message:{id:"notification.error",message:d(c),defaultMessage:"An error occured"}})}});return ee?(0,e.jsxs)(g.o,{"aria-busy":S,children:[(0,e.jsx)(t.SettingsPageTitle,{name:"Users"}),(0,e.jsx)(K.T,{primaryAction:F&&(0,e.jsx)(ee,{onClick:se}),title:ie,subtitle:O({id:"Settings.permissions.users.listview.header.subtitle",defaultMessage:"All the users who have access to the Strapi admin panel"})}),v&&(0,e.jsx)(J.Z,{startActions:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(t.SearchURLQuery,{label:O({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:ie})}),(0,e.jsx)(de.F,{displayedFilters:Le})]})}),(0,e.jsxs)(X.D,{canRead:v,children:[!v&&(0,e.jsx)(t.NoPermissions,{}),$&&(0,e.jsx)("div",{children:"TODO: An error occurred"}),v&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(t.DynamicTable,{contentType:"Users",isLoading:S,onConfirmDeleteAll:Y.mutateAsync,onConfirmDelete:c=>Y.mutateAsync([c]),headers:ne,rows:Z,withBulkActions:!0,withMainAction:B,children:(0,e.jsx)(ce,{canDelete:B,headers:ne,rows:Z,withBulkActions:!0,withMainAction:B})}),R&&(0,e.jsx)(me,{pagination:R})]})]}),T&&(0,e.jsx)(Me,{onSuccess:async()=>{await V(),await p.refetchQueries(pe)},onToggle:se})]}):null},ve=()=>{const a=(0,b.p)(Pe,async()=>(await s.e(9911).then(s.bind(s,79911))).UserListPageEE);return a?(0,e.jsx)(a,{}):null},Re=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=(0,D.useSelector)(P.s);return(0,e.jsx)(t.CheckPagePermissions,{permissions:a.settings.users.main,children:(0,e.jsx)(ve,{})})}},Symbol.toStringTag,{value:"Module"}))},79211:(re,I,s)=>{s.d(I,{F:()=>C});var e=s(74081),t=s(27279),D=s(93415),P=s(48102),f=s(1180),y=s(57121),o=s(70627),h=s(61020);const C=({displayedFilters:i})=>{const[u,_]=(0,t.useState)(!1),{formatMessage:x}=(0,h.Z)(),l=(0,t.useRef)(),E=()=>{_(G=>!G)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(D.x,{paddingTop:1,paddingBottom:1,children:[(0,e.jsx)(P.z,{variant:"tertiary",ref:l,startIcon:(0,e.jsx)(y.Z,{}),onClick:E,size:"S",children:x({id:"app.utils.filters",defaultMessage:"Filters"})}),u&&(0,e.jsx)(f.FilterPopoverURLQuery,{displayedFilters:i,isVisible:u,onToggle:E,source:l})]}),(0,e.jsx)(f.FilterListURLQuery,{filtersSchema:i})]})};C.propTypes={displayedFilters:o.arrayOf(o.shape({name:o.string.isRequired,metadatas:o.shape({label:o.string}),fieldSchema:o.shape({type:o.string})})).isRequired}},83595:(re,I,s)=>{s.d(I,{M:()=>l,S:()=>W,a:()=>x});var e=s(74081),t=s(70627),D=s(61020),P=s(92401),f=s(4987),y=s(5627),o=s(78955),h=s(1180),C=s(78031),i=s(34547),u=s(40464),_=s(72450);const x=({children:j,target:g})=>{const K=(0,h.useNotification)(),{formatMessage:J}=(0,D.Z)(),{copy:X}=(0,h.useClipboard)(),k=J({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),M=async()=>{await X(g)&&K({type:"info",message:{id:"notification.link-copied"}})};return(0,e.jsx)(h.ContentBox,{endAction:(0,e.jsx)(f.h,{label:k,noBorder:!0,icon:(0,e.jsx)(C.Z,{}),onClick:M}),title:g,titleEllipsis:!0,subtitle:j,icon:(0,e.jsx)("span",{style:{fontSize:32},children:"\u2709\uFE0F"}),iconBackground:"neutral100"})};x.propTypes={children:t.oneOfType([t.element,t.string]).isRequired,target:t.string.isRequired};const l=({registrationToken:j})=>{const{formatMessage:g}=(0,D.Z)(),K=`${window.location.origin}${(0,P.T)()}/auth/register?registrationToken=${j}`;return(0,e.jsx)(x,{target:K,children:g({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})})};l.defaultProps={registrationToken:""},l.propTypes={registrationToken:t.string};const E=(0,_.keyframes)`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,G=_.default.div`
  animation: ${E} 2s infinite linear;
`,oe=()=>(0,e.jsx)(G,{children:(0,e.jsx)(i.Z,{})}),te=async()=>{const{get:j}=(0,h.getFetchClient)(),{data:g}=await j("/admin/roles");return g.data},W=({disabled:j,error:g,onChange:K,value:J})=>{const{status:X,data:k}=(0,u.useQuery)(["roles"],te,{staleTime:5e4}),{formatMessage:M}=(0,D.Z)(),z=g?M({id:g,defaultMessage:g}):"",ae=M({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),le=M({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),b=M({id:"app.components.Select.placeholder",defaultMessage:"Select"}),de=X==="loading"?(0,e.jsx)(oe,{}):void 0;return(0,e.jsx)(y.P,{id:"roles",disabled:j,error:z,hint:le,label:ae,name:"roles",onChange:A=>{K({target:{name:"roles",value:A}})},placeholder:b,multi:!0,startIcon:de,value:J.map(A=>A.toString()),withTags:!0,required:!0,children:(k||[]).map(A=>(0,e.jsx)(o.W,{value:A.id.toString(),children:M({id:`global.${A.code}`,defaultMessage:A.name})},A.id))})};W.defaultProps={disabled:!1,error:void 0},W.propTypes={disabled:t.bool,error:t.string,onChange:t.func.isRequired,value:t.array.isRequired}},11266:(re,I,s)=>{s.d(I,{u:()=>P});var e=s(27279),t=s(1180),D=s(40464);function P(f={},y={}){const{id:o="",...h}=f,{get:C}=(0,t.useFetchClient)(),{data:i,isError:u,isLoading:_,refetch:x}=(0,D.useQuery)(["users",o,h],async()=>{const{data:{data:E}}=await C(`/admin/users/${o}`,{params:h});return E},y);return{users:e.useMemo(()=>{let E=[];return i&&("results"in i?Array.isArray(i.results)&&(E=i.results):E=[i]),E},[i]),pagination:e.useMemo(()=>(i&&"pagination"in i)??null,[i]),isLoading:_,isError:u,refetch:x}}}}]);
